<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Will you be my Valentine?</title>
  <style>
    :root { --pink:#ff4d88; --pink2:#ff77aa; }
    body{
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(circle at top, #ffe3ee, #fff);
      color:#222;
      overflow:hidden;
    }
    .card{
      width:min(560px, 92vw);
      background: rgba(255,255,255,.9);
      border: 1px solid #ffd0df;
      border-radius: 22px;
      box-shadow: 0 18px 60px rgba(255, 77, 136, .18);
      padding: 26px 20px;
      text-align:center;
      position:relative;
    }
    h1{
      margin: 4px 0 14px;
      font-size: clamp(24px, 3.6vw, 36px);
      letter-spacing: .2px;
    }
    #message{
      margin: 10px 0 14px;
      font-size: 18px;
      min-height: 24px;
    }
    .gif{
      width: min(420px, 86vw);
      height: auto;
      border-radius: 16px;
      border: 1px solid #ffd0df;
      box-shadow: 0 10px 25px rgba(0,0,0,.06);
      user-select:none;
      -webkit-user-drag:none;
      background:#fff;
    }
    .btns{
      margin-top: 18px;
      display:flex;
      gap: 14px;
      justify-content:center;
      flex-wrap:wrap;
    }
    button{
      border:0;
      padding: 12px 18px;
      border-radius: 999px;
      font-size: 18px;
      cursor:pointer;
      transition: transform .08s ease, box-shadow .2s ease, background .2s ease;
      box-shadow: 0 12px 20px rgba(0,0,0,.08);
    }
    button:active{ transform: scale(0.98); }
    #yesBtn{
      background: linear-gradient(135deg, var(--pink), var(--pink2));
      color:white;
    }
    #yesBtn:hover{ box-shadow: 0 14px 26px rgba(255,77,136,.28); }
    #noBtn{
      background: #f1f1f1;
      color:#333;
      position: relative;
    }

    /* floating hearts */
    .heart{
      position: absolute;
      font-size: 18px;
      opacity: .85;
      animation: floatUp 2.6s ease-in forwards;
      pointer-events:none;
      user-select:none;
    }
    @keyframes floatUp{
      from{ transform: translateY(0) scale(1); opacity:.9; }
      to{ transform: translateY(-120px) scale(1.25); opacity:0; }
    }

    /* floating sticker (shown only after YES) */
    #sticker{
      position:absolute;
      top: 15px;
      right: 15px;
      width: 110px;
      height: 110px;
      object-fit: contain;   /* NO CROPPING */
      background: white;
      padding: 6px;
      border-radius: 22px;
      border: 3px solid white;
      box-shadow: 0 12px 30px rgba(0,0,0,0.25);
      display: none;
      animation: floatSticker 3s ease-in-out infinite;
      z-index: 5;
    }
    @keyframes floatSticker {
      0% { transform: translateY(0px) rotate(6deg); }
      50% { transform: translateY(-12px) rotate(6deg); }
      100% { transform: translateY(0px) rotate(6deg); }
    }
  </style>
</head>
<body>

  <!-- AUDIO -->
  <!-- First page tracks: play one after another -->
  <audio id="bg1" preload="auto">
    <source src="goblin_amnesia.mp3" type="audio/mpeg">
  </audio>

  <audio id="bg2" preload="auto">
    <!-- file has a space -> %20 -->
    <source src="goblin_amnesia%202.mp3" type="audio/mpeg">
  </audio>

  <!-- YES page track (loops) -->
  <audio id="drop" loop preload="auto">
    <source src="leja_instrumental.mp3" type="audio/mpeg">
  </audio>

  <div class="card" id="card">
    <h1 id="title">Will you be my Valentine? üíå</h1>

    <!-- First page: your photo -->
    <img
      id="mainGif"
      class="gif"
      alt=""
      src="IMG_1066.jpeg"
    />

    <!-- Sticker (only visible after YES) -->
    <img id="sticker" src="sticker.jpeg" alt="">

    <div id="message"></div>

    <div class="btns" id="btns">
      <button id="yesBtn">Yes üíñ</button>
      <button id="noBtn">No üò≥</button>
    </div>
  </div>

<script>
  const noBtn = document.getElementById("noBtn");
  const yesBtn = document.getElementById("yesBtn");
  const msg = document.getElementById("message");
  const title = document.getElementById("title");
  const gif = document.getElementById("mainGif");
  const card = document.getElementById("card");
  const btns = document.getElementById("btns");
  const sticker = document.getElementById("sticker");

  // Audio
  const bg1 = document.getElementById("bg1");
  const bg2 = document.getElementById("bg2");
  const drop = document.getElementById("drop");

  // ---------- MUSIC (FIRST PAGE: one after another) ----------
  let started = false;
  let onYesPage = false;

  // volumes
  bg1.volume = 0.28;
  bg2.volume = 0.28;
  drop.volume = 0.90;

  // Chain bg1 -> bg2 -> bg1 forever
  bg1.addEventListener("ended", () => {
    if (onYesPage) return;
    bg2.currentTime = 0;
    bg2.play().catch(()=>{});
  });
  bg2.addEventListener("ended", () => {
    if (onYesPage) return;
    bg1.currentTime = 0;
    bg1.play().catch(()=>{});
  });

  function startFirstPageMusicOnce() {
    if (started || onYesPage) return;
    started = true;
    bg1.currentTime = 0;
    bg1.play().catch(()=>{});
  }

  function stopFirstPageMusic() {
    bg1.pause(); bg1.currentTime = 0;
    bg2.pause(); bg2.currentTime = 0;
  }

  function startYesMusic() {
    onYesPage = true;
    stopFirstPageMusic();
    drop.currentTime = 0;
    drop.play().catch(()=>{});
  }

  // iPhone-friendly: start on first tap anywhere
  document.addEventListener("touchstart", startFirstPageMusicOnce, { once: true, passive: true });
  document.addEventListener("click", startFirstPageMusicOnce, { once: true });

  // ---------- UI ----------
  const DODGE_TRIES_BEFORE_CLICKABLE = 10;
  let dodgeCount = 0;
  let noClickStage = 0;

  function randBetween(min, max){ return Math.floor(Math.random()*(max-min+1))+min; }

  function moveNoButton(){
    const rect = card.getBoundingClientRect();
    const btnRect = noBtn.getBoundingClientRect();

    const padding = 14;
    const maxX = rect.width - btnRect.width - padding;
    const maxY = rect.height - btnRect.height - padding;

    const x = randBetween(padding, Math.max(padding, maxX));
    const y = randBetween(padding, Math.max(padding, maxY));

    noBtn.style.position = "absolute";
    noBtn.style.left = x + "px";
    noBtn.style.top = y + "px";
  }

  function spawnHeart(x, y){
    const h = document.createElement("div");
    h.className = "heart";
    h.textContent = ["üíñ","üíò","üíï","üíó","üíù"][randBetween(0,4)];
    h.style.left = x + "px";
    h.style.top = y + "px";
    card.appendChild(h);
    setTimeout(() => h.remove(), 2600);
  }

  function handleNoApproach(){
    startFirstPageMusicOnce();

    if (dodgeCount < DODGE_TRIES_BEFORE_CLICKABLE) {
      dodgeCount++;
      moveNoButton();
      msg.textContent = "No? üò≥";
    } else {
      msg.textContent = "Okay‚Ä¶ you can click No now üò¢";
      noBtn.removeEventListener("mouseenter", handleNoApproach);
      noBtn.removeEventListener("touchstart", handleNoApproach);
    }
  }

  noBtn.addEventListener("mouseenter", handleNoApproach);
  noBtn.addEventListener("touchstart", handleNoApproach, { passive: true });

  noBtn.addEventListener("click", () => {
    startFirstPageMusicOnce();
    if (dodgeCount < DODGE_TRIES_BEFORE_CLICKABLE) return;

    if (noClickStage === 0) {
      msg.textContent = "Are you sure? üò¢";
      noBtn.textContent = "No‚Ä¶";
      noClickStage = 1;
    } else if (noClickStage === 1) {
      msg.textContent = "I will cry üò≠";
      noBtn.textContent = "Still no üò≠";
      noClickStage = 2;
    } else {
      msg.textContent = "My heart is breaking‚Ä¶ üíî";
    }
  });

  // YES flow
  yesBtn.addEventListener("click", () => {
    startFirstPageMusicOnce();
    startYesMusic();

    sticker.style.display = "block";
    title.textContent = "YAYYYYY!!! üíò";
    msg.textContent = "I love you so much üíñüíòüíïüíóüíù";

    // ‚úÖ Your uploaded hearts animation
    gif.src = "hearts.gif";

    btns.innerHTML = "";

    const rect = card.getBoundingClientRect();
    for (let i=0; i<22; i++){
      spawnHeart(randBetween(40, rect.width-40), randBetween(80, rect.height-40));
    }
  });

  moveNoButton();
  window.addEventListener("resize", () => {
    if (dodgeCount < DODGE_TRIES_BEFORE_CLICKABLE) moveNoButton();
  });
</script>
</body>
</html>
